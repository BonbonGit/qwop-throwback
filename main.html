<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>QWOP-Throwback</title>
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript">
      var canvas;
      var ctx;
      class GObject{
        constructor(width=10, height=10, x=0, y=0, angle=0){
          this.width = width;
          this.height = height;
          this.x = x;
          this.y = y;
          this.angle = angle;
          this.hitX = Math.cos(this.angle+Math.PI/4)*Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2));
          console.log(this.angle);
          this.hitY = Math.sin(this.angle+Math.PI/4)*Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2));
          console.log(this.hitX);
          console.log(this.hitY);
          this.xSpeed = 0;
          this.ySpeed = 0;
          this.rotSpeed = 0;
        }
        accelerate(xAcc, yAcc, rotAcc){
          this.xSpeed += xAcc * Game.tSLF;
          this.ySpeed += yAcc * Game.tSLF;
          this.rotSpeed += rotAcc * Game.tSLF;
        }
        updatePos(){
          this.x += this.xSpeed * Game.tSLF;
          this.y += this.ySpeed * Game.tSLF;
          if(this.rotSpeed != 0){
            this.angle += this.rotSpeed * Game.tSLF;
            Math.cos(Math.floor(this.angle%Math.PI/2)+Math.PI/4)*Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2));
            this.hitY = Math.sin(Math.floor(this.angle%Math.PI/2)+Math.PI/4)*Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2));
          }
        }

      }
      class GColorObject extends GObject{
        constructor(width=10, height=10, x=0, y=0, angle=0, color='red'){
          super(width, height, x, y, angle)
          this.color = color;
        }
        render(){
          ctx.fillStyle = this.color;

          ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
          ctx.restore();

        }
      }


      var Game = {

        now: 0,
        then: 0,
        tSLF:0,//time since last frame

        gravity:10, //gravitational acceleration in px/sec
        blueSquare: new GColorObject(20, 20, 10, 750, Math.PI/4, 'blue'),
        greenSquare: new GColorObject(20, 20, 1190, 750, 0, 'green'),
        //wall: new GColorObject(40, 600, 600, 400, 0, 'red'),
        update: function(){
          this.blueSquare.accelerate(0, this.gravity, 0);
          this.blueSquare.updatePos();
          this.greenSquare.accelerate(0, this.gravity, 0);
          this.greenSquare.updatePos();
          this.contact();
        },
        render: function(){
          ctx.clearRect(0,0,canvas.width,canvas.height);
          this.blueSquare.render();
          this.greenSquare.render();
          //this.wall.render();
        },
        contact: function(){
          /*if(Math.abs(this.greenSquare.x-this.wall.x) <= (this.greenSquare.width+this.wall.width)/2){
            this.greenSquare.xSpeed = -this.greenSquare.xSpeed
          }
          if(Math.abs(this.blueSquare.x-this.wall.x) <= (this.blueSquare.width+this.wall.width)/2){
            this.blueSquare.xSpeed = -this.blueSquare.xSpeed
          }*/
          if(Math.abs(this.blueSquare.x-this.greenSquare.x) <= (this.blueSquare.hitX+this.greenSquare.hitX)){
            this.blueSquare.xSpeed = -this.blueSquare.xSpeed;
            this.greenSquare.xSpeed = -this.greenSquare.xSpeed;
          }
        }
      }
      function init(){
        canvas = document.getElementById('gameArea');
        ctx = canvas.getContext('2d');
        Game.then = performance.now();
        Game.blueSquare.xSpeed = 100;
        Game.blueSquare.ySpeed = -100;
        Game.greenSquare.xSpeed = -100;
        Game.greenSquare.ySpeed = -100;
        main();
      }
      function main() {
        window.requestAnimationFrame( main );
        //time at loop start
        Game.now = performance.now();
        Game.tSLF = (Game.now - Game.then)/1000;

        if(Game.tSLF > 16/1000){ //Aprox 60FPS
          //console.log(1/Game.tSLF);
          Game.update();
          Game.render();
          Game.then = Game.now;
        }
      }

    </script>
  </head>
  <body onload="init()">
    <canvas id="gameArea" height="800" width="1200"></canvas>
  </body>
</html>
